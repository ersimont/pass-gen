@use "sass:map";
@use "@angular/material" as mat;

// colors

@mixin _module-color($name, $theme) {
  @if $name == "all" {
    @include mat.all-component-colors($theme);
  } @else if $name == "autocomplete" {
    @include mat.autocomplete-color($theme);
  } @else if $name == "badge" {
    @include mat.badge-color($theme);
  } @else if $name == "bottom-sheet" {
    @include mat.bottom-sheet-color($theme);
  } @else if $name == "button" {
    @include mat.button-color($theme);
  } @else if $name == "button-toggle" {
    @include mat.button-toggle-color($theme);
  } @else if $name == "card" {
    @include mat.card-color($theme);
  } @else if $name == "checkbox" {
    @include mat.checkbox-color($theme);
  } @else if $name == "chips" {
    @include mat.chips-color($theme);
  } @else if $name == "core" {
    @include mat.core-color($theme);
  } @else if $name == "datepicker" {
    @include mat.datepicker-color($theme);
  } @else if $name == "dialog" {
    @include mat.dialog-color($theme);
  } @else if $name == "divider" {
    @include mat.divider-color($theme);
  } @else if $name == "expansion" {
    @include mat.expansion-color($theme);
  } @else if $name == "form-field" {
    @include mat.form-field-color($theme);
  } @else if $name == "grid-list" {
    @include mat.grid-list-color($theme);
  } @else if $name == "icon" {
    @include mat.icon-color($theme);
  } @else if $name == "input" {
    @include mat.input-color($theme);
  } @else if $name == "list" {
    @include mat.list-color($theme);
  } @else if $name == "menu" {
    @include mat.menu-color($theme);
  } @else if $name == "paginator" {
    @include mat.paginator-color($theme);
  } @else if $name == "progress-bar" {
    @include mat.progress-bar-color($theme);
  } @else if $name == "progress-spinner" {
    @include mat.progress-spinner-color($theme);
  } @else if $name == "radio" {
    @include mat.radio-color($theme);
  } @else if $name == "select" {
    @include mat.select-color($theme);
  } @else if $name == "sidenav" {
    @include mat.sidenav-color($theme);
  } @else if $name == "slide-toggle" {
    @include mat.slide-toggle-color($theme);
  } @else if $name == "slider" {
    @include mat.slider-color($theme);
  } @else if $name == "snack-bar" {
    @include mat.snack-bar-color($theme);
  } @else if $name == "sort" {
    @include mat.sort-color($theme);
  } @else if $name == "stepper" {
    @include mat.stepper-color($theme);
  } @else if $name == "table" {
    @include mat.table-color($theme);
  } @else if $name == "tabs" {
    @include mat.tabs-color($theme);
  } @else if $name == "toolbar" {
    @include mat.toolbar-color($theme);
  } @else if $name == "tooltip" {
    @include mat.tooltip-color($theme);
  } @else if $name == "tree" {
    @include mat.tree-color($theme);
  }
}

@mixin _module-colors($theme, $config) {
  $modules: map.get($config, "modules") or ("all");
  @each $name in $modules {
    @include _module-color($name, $theme);
  }
}

@function _build-color-arg($config, $color-key) {
  @return (color: map.get($config, $color-key));
}

@mixin dark-theme-colors($config, $color-key: "dark-color") {
  $theme: mat.define-dark-theme(_build-color-arg($config, $color-key));
  @include _module-colors($theme, $config);
}

@mixin light-theme-colors($config, $color-key: "light-color") {
  $theme: mat.define-light-theme(_build-color-arg($config, $color-key));
  @include _module-colors($theme, $config);
}

// themes

@mixin _module-theme($name, $theme) {
  @if $name == "all" {
    @include mat.all-component-themes($theme);
  } @else if $name == "autocomplete" {
    @include mat.autocomplete-theme($theme);
  } @else if $name == "badge" {
    @include mat.badge-theme($theme);
  } @else if $name == "bottom-sheet" {
    @include mat.bottom-sheet-theme($theme);
  } @else if $name == "button" {
    @include mat.button-theme($theme);
  } @else if $name == "button-toggle" {
    @include mat.button-toggle-theme($theme);
  } @else if $name == "card" {
    @include mat.card-theme($theme);
  } @else if $name == "checkbox" {
    @include mat.checkbox-theme($theme);
  } @else if $name == "chips" {
    @include mat.chips-theme($theme);
  } @else if $name == "core" {
    @include mat.core-theme($theme);
  } @else if $name == "datepicker" {
    @include mat.datepicker-theme($theme);
  } @else if $name == "dialog" {
    @include mat.dialog-theme($theme);
  } @else if $name == "divider" {
    @include mat.divider-theme($theme);
  } @else if $name == "expansion" {
    @include mat.expansion-theme($theme);
  } @else if $name == "form-field" {
    @include mat.form-field-theme($theme);
  } @else if $name == "grid-list" {
    @include mat.grid-list-theme($theme);
  } @else if $name == "icon" {
    @include mat.icon-theme($theme);
  } @else if $name == "input" {
    @include mat.input-theme($theme);
  } @else if $name == "list" {
    @include mat.list-theme($theme);
  } @else if $name == "menu" {
    @include mat.menu-theme($theme);
  } @else if $name == "paginator" {
    @include mat.paginator-theme($theme);
  } @else if $name == "progress-bar" {
    @include mat.progress-bar-theme($theme);
  } @else if $name == "progress-spinner" {
    @include mat.progress-spinner-theme($theme);
  } @else if $name == "radio" {
    @include mat.radio-theme($theme);
  } @else if $name == "select" {
    @include mat.select-theme($theme);
  } @else if $name == "sidenav" {
    @include mat.sidenav-theme($theme);
  } @else if $name == "slide-toggle" {
    @include mat.slide-toggle-theme($theme);
  } @else if $name == "slider" {
    @include mat.slider-theme($theme);
  } @else if $name == "snack-bar" {
    @include mat.snack-bar-theme($theme);
  } @else if $name == "sort" {
    @include mat.sort-theme($theme);
  } @else if $name == "stepper" {
    @include mat.stepper-theme($theme);
  } @else if $name == "table" {
    @include mat.table-theme($theme);
  } @else if $name == "tabs" {
    @include mat.tabs-theme($theme);
  } @else if $name == "toolbar" {
    @include mat.toolbar-theme($theme);
  } @else if $name == "tooltip" {
    @include mat.tooltip-theme($theme);
  } @else if $name == "tree" {
    @include mat.tree-theme($theme);
  }
}

@mixin _module-themes($theme, $config) {
  $modules: map.get($config, "modules") or ("all");
  @each $name in $modules {
    @include _module-theme($name, $theme);
  }
}

@function _build-theme-arg($config, $color-key) {
  @return (
    color: map.get($config, $color-key),
    typography: map.get($config, "typography"),
    density: map.get($config, "density") or 0
  );
}

@mixin dark-theme($config, $color-key: "dark-color") {
  $theme: mat.define-dark-theme(_build-theme-arg($config, $color-key));
  @include _module-themes($theme, $config);
}

@mixin light-theme($config, $color-key: "light-color") {
  $theme: mat.define-light-theme(_build-theme-arg($config, $color-key));
  @include _module-themes($theme, $config);
}

// putting it all together

@mixin full-theming($config) {
  @include mat.core();
  @include dark-theme($config);
  @media (prefers-color-scheme: light) {
    @include light-theme-colors($config);
  }
}
